<!-- src/app/components/profile/profile.component.html -->
<div class="container py-5">
  <div class="row justify-content-center">
    <div class="col-lg-10">


      <div class="card shadow-lg border-0 rounded-4 overflow-hidden">

        <div class="card-header text-white text-center py-5 position-relative"
          style="background: linear-gradient(135deg, #059669, #10b981); height: 200px;">
        </div>

        <div class="card-body px-5 pb-5 pt-0 position-relative">

          <div class="d-flex justify-content-between align-items-end" style="margin-top: -75px;">
            <div class="position-relative d-inline-block">
              <img [src]="previewAvatar" class="rounded-circle border border-5 border-white shadow-lg bg-white"
                width="150" height="150" alt="Profile" style="object-fit: cover;">

              <label class="btn btn-light rounded-circle position-absolute bottom-0 end-0 shadow-lg"
                style="width:40px;height:40px;cursor:pointer" (drop)="onDrop($event)" (dragover)="onDragOver($event)"
                title="Change Profile Picture">
                <i class="bi bi-camera-fill text-secondary"></i>
                <input type="file" accept="image/*" hidden (change)="onAvatarChange($event)">
              </label>
            </div>

            <div class="d-none d-md-block">
              <button class="btn btn-outline-primary rounded-pill px-4 me-2" (click)="showEdit=true">
                <i class="bi bi-pencil-square me-2"></i> Edit Profile
              </button>
              <button class="btn btn-outline-secondary rounded-pill px-4" (click)="showPass=true">
                <i class="bi bi-key me-2"></i> Password
              </button>
            </div>
          </div>

          <div class="mt-3">
            <h2 class="fw-bold mb-1">{{ user?.name }}</h2>
            <p class="text-muted mb-2"><i class="bi bi-envelope me-2"></i>{{ user?.email }}</p>
            <span class="badge rounded-pill px-3 py-2" [ngClass]="{
                    'bg-primary': user?.role === 'DOCTOR',
                    'bg-success': user?.role === 'ADMIN',
                    'bg-info': user?.role === 'PATIENT'
                  }">
              {{ user?.role }}
            </span>
            <div *ngIf="user?.role === 'DOCTOR' && user?.specialty" class="mt-2 fs-5 text-success fw-bold">
              <i class="bi bi-patch-check-fill me-2"></i>{{ user?.specialty }}
            </div>
          </div>

          <hr class="my-4">


          <div class="row g-4">

            <div class="col-md-6">
              <h5 class="fw-bold mb-3 text-primary"><i class="bi bi-person-lines-fill me-2"></i>Personal Information
              </h5>
              <div class="bg-light rounded-4 p-4">
                <div class="mb-3">
                  <label class="small text-muted text-uppercase fw-bold">Phone</label>
                  <div class="fw-medium">{{ user?.phone || 'Not provided' }}</div>
                </div>
                <div class="mb-3">
                  <label class="small text-muted text-uppercase fw-bold">Gender</label>
                  <div class="fw-medium">{{ user?.gender || 'Not specified' }}</div>
                </div>
                <div class="mb-3">
                  <label class="small text-muted text-uppercase fw-bold">Date of Birth</label>
                  <div class="fw-medium">{{ user?.dateOfBirth || 'Not provided' }}</div>
                </div>
                <div class="mb-0">
                  <label class="small text-muted text-uppercase fw-bold">Address</label>
                  <div class="fw-medium">{{ user?.address || 'Not provided' }}</div>
                </div>
              </div>
            </div>


            <div class="col-md-6">
              <h5 class="fw-bold mb-3 text-primary"><i class="bi bi-card-text me-2"></i>About</h5>
              <div class="bg-light rounded-4 p-4 h-100">
                <p class="text-muted" *ngIf="!user?.bio">No bio added yet. Tell us about yourself!</p>
                <p class="text-dark" *ngIf="user?.bio">{{ user?.bio }}</p>
              </div>
            </div>
          </div>


          <div class="d-grid gap-2 mt-4 d-md-none">
            <button class="btn btn-outline-primary rounded-pill" (click)="showEdit=true">
              <i class="bi bi-pencil-square me-2"></i> Edit Profile
            </button>
            <button class="btn btn-outline-secondary rounded-pill" (click)="showPass=true">
              <i class="bi bi-key me-2"></i> Change Password
            </button>
          </div>

        </div>
      </div>
    </div>
  </div>
</div>


<div class="modal fade show d-block bg-dark bg-opacity-50" *ngIf="showEdit">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content rounded-4 border-0 shadow-lg">
      <div class="modal-header border-bottom-0 pb-0">
        <h5 class="modal-title fw-bold">Edit Profile</h5>
        <button class="btn-close" (click)="showEdit=false"></button>
      </div>
      <div class="modal-body pt-4">
        <div class="row g-3">
          <div class="col-md-6">
            <label class="form-label fw-bold small text-uppercase text-muted">Full Name</label>
            <input type="text" class="form-control form-control-lg bg-light border-0" [(ngModel)]="editForm.name">
          </div>
          <div class="col-md-6">
            <label class="form-label fw-bold small text-uppercase text-muted">Email</label>
            <input type="email" class="form-control form-control-lg bg-light border-0" [(ngModel)]="editForm.email">
          </div>
          <div class="col-md-6">
            <label class="form-label fw-bold small text-uppercase text-muted">Phone</label>
            <input type="text" class="form-control form-control-lg bg-light border-0" [(ngModel)]="editForm.phone">
          </div>
          <div class="col-md-6">
            <label class="form-label fw-bold small text-uppercase text-muted">Gender</label>
            <select class="form-select form-select-lg bg-light border-0" [(ngModel)]="editForm.gender">
              <option value="">Select Gender</option>
              <option value="Male">Male</option>
              <option value="Female">Female</option>
              <option value="Other">Other</option>
            </select>
          </div>
          <div class="col-md-6" *ngIf="user?.role === 'DOCTOR'">
            <label class="form-label fw-bold small text-uppercase text-muted">Specialty</label>
            <input type="text" class="form-control form-control-lg bg-light border-0" [(ngModel)]="editForm.specialty"
              placeholder="e.g. Cardiologist">
          </div>
          <div class="col-md-6">
            <label class="form-label fw-bold small text-uppercase text-muted">Date of Birth</label>
            <input type="date" class="form-control form-control-lg bg-light border-0"
              [(ngModel)]="editForm.dateOfBirth">
          </div>
          <div class="col-12">
            <label class="form-label fw-bold small text-uppercase text-muted">Address</label>
            <textarea class="form-control bg-light border-0" rows="2" [(ngModel)]="editForm.address"></textarea>
          </div>
          <div class="col-12">
            <label class="form-label fw-bold small text-uppercase text-muted">Bio</label>
            <textarea class="form-control bg-light border-0" rows="3" [(ngModel)]="editForm.bio"
              placeholder="Write a short bio..."></textarea>
          </div>
        </div>
      </div>
      <div class="modal-footer border-top-0">
        <button class="btn btn-light rounded-pill px-4" (click)="showEdit=false">Cancel</button>
        <button class="btn btn-primary rounded-pill px-4" (click)="saveProfile()" [disabled]="loading">
          <span *ngIf="loading" class="spinner-border spinner-border-sm me-2"></span>
          Save Changes
        </button>
      </div>
    </div>
  </div>
</div>


<div class="modal fade show d-block bg-dark bg-opacity-50" *ngIf="showPass">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content rounded-4 border-0 shadow-lg">
      <div class="modal-header border-bottom-0 pb-0">
        <h5 class="modal-title fw-bold">Change Password</h5>
        <button class="btn-close" (click)="showPass=false"></button>
      </div>
      <div class="modal-body pt-4">
        <div class="mb-3">
          <label class="form-label fw-bold small text-uppercase text-muted">Current Password</label>
          <input type="password" class="form-control form-control-lg bg-light border-0" [(ngModel)]="passForm.current">
        </div>
        <div class="mb-3">
          <label class="form-label fw-bold small text-uppercase text-muted">New Password</label>
          <input type="password" class="form-control form-control-lg bg-light border-0" [(ngModel)]="passForm.new">
        </div>
        <div class="mb-3">
          <label class="form-label fw-bold small text-uppercase text-muted">Confirm Password</label>
          <input type="password" class="form-control form-control-lg bg-light border-0" [(ngModel)]="passForm.confirm">
        </div>
      </div>
      <div class="modal-footer border-top-0">
        <button class="btn btn-light rounded-pill px-4" (click)="showPass=false">Cancel</button>
        <button class="btn btn-warning rounded-pill px-4 text-white" (click)="changePassword()" [disabled]="loading">
          <span *ngIf="loading" class="spinner-border spinner-border-sm me-2"></span>
          Update Password
        </button>
      </div>
    </div>
  </div>
</div>